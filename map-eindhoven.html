<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link rel="stylesheet" href="leaflet/leaflet.css" />
  <link rel="stylesheet" href="style/map-style.css" />
  
  <script src="leaflet/leaflet.js"></script>
  <script src="leaflet/leaflet.ajax.min.js"></script>
  <script src="leaflet/leaflet-providers.js"></script>
</head>

<body>
  <style>
  #dm4ym { height: 100%; }
  </style>

  <div id="dm4ym"></div>

  <script>
  var mymap = L.map('dm4ym');

  // tile layers
  var mapNik = L.tileLayer.provider('OpenStreetMap.Mapnik');
  var blackAndWhiteLayer = L.tileLayer.provider('OpenStreetMap.BlackAndWhite');
  var stamenTonerLayer = L.tileLayer.provider('Stamen.Toner');
  var WImagEsriLayer = L.tileLayer.provider('Esri.WorldImagery');
    

  mymap.setView([51.43555, 5.48055], 17); 
  mymap.addLayer(stamenTonerLayer);

  var baseMaps = {
    "Mapnik": mapNik,
    "BlackAndWhite": blackAndWhiteLayer,
    "StamenToner": stamenTonerLayer,
    "WImagEsriLayer":stamenTonerLayer
  };

  var happyIcon = L.icon({
    iconUrl: 'img/happy_f.png',
  });

  var sadIcon = L.icon({
    iconUrl: 'img/sad_f.png'
  });

  var angryIcon = L.icon({
    iconUrl: 'img/angry_f.png'
  });

  var categories = {},
  category;

  var overlays = {},
  categoryName,
  categoryArray;

  var geojsonLayer = new L.GeoJSON.AJAX("test-eindhoven.geojson", {
    pointToLayer: function (feature, latlng) {
      switch (feature.properties.Emotion) {
        case 'happy': return L.marker(latlng, {icon: happyIcon});
        case 'sad': return L.marker(latlng, {icon: sadIcon});
        case 'angry': return L.marker(latlng, {icon: angryIcon});
      }
    },
    onEachFeature(feature, layer) {
      var classNameInfoWindow = emotionCategoryInfoWindowStyle(feature);
      
      var customOptions =
        {
          'className' : classNameInfoWindow
        };
      
      layer.bindPopup(definePopup(feature),customOptions);
      
      category = feature.properties.Emotion;

      if (typeof categories[category] === "undefined") {
        categories[category] = [];
      }
      
      
      categories[category].push(layer);
      
    }
  });

  geojsonLayer.on('data:loaded', function() {
    for (categoryName in categories) {
      categoryArray = categories[categoryName];
      overlays[categoryName] = L.layerGroup(categoryArray);
    }

    overlays['happy'].addTo(mymap);
    overlays['sad'].addTo(mymap);
    overlays['angry'].addTo(mymap);

    L.control.layers(baseMaps, overlays).addTo(mymap);
  });

   function definePopup(feature) {
     var props = feature.properties;

     var emotion = props.Emotion;
     var popupText = `
      <div class="containerinfo">
        <div class= "boxlogoandemotion">
          <div class= "logo sqre">
            <img src="img/logodm4ym.png">
          </div>
          <div class= "emotion sqre">` +
  '            <img src="svg/'+ emotion+ '.svg"> ' +
  '            <p class="emotionname">'+emotion +'</p> '+
  '        </div>
        </div> `
          <div class= "boxtextdata"> ` 
            //<!--get from table description --> 
  '          <p><b>date:</b> ' + props.Date + ' ' + props.Time + '</p> ' +
  '          <p><b>description:</b>'+ ' ' + props.Notes +'</p> ' +
  '       </div>
          <div class= "boximg"> ` +
            "<img src='"+ props.SourceFile +"'"+
            ">"+"</img>" +             
  `        </div>
          
      </div>
  `;
            
      return popupText;
  }
    
    function emotionCategoryInfoWindowStyle(feature) {
      return feature.properties.Emotion + "-bg";
    }
    
/*//  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 5.48474722222222,51.4310416666667 ]
    },
    "properties": {
    "SourceFile":"./uploads/IPTC5ab2962269e437.16168948.jpg",
    "ObjectName":"happy"
    "Date":"9/26/17", //todo
    "Time":"9:47:44", //todo
    "GMT":"-4:00:00", //todo
    }
  }, */
    
//  {
//    "type": "Feature",
//    "geometry": {
//       "type": "Point",
//       "coordinates":  [ 1.597731,42.567689 ]
//    },
//    "properties": {
//    "FileName":"angry_IPTC59ca5a808ffc15.84268283.jpg",
//    "Emotion":"angry",
//    "Date":"9/26/17",
//    "Time":"9:47:44",
//    "GMT":"-4:00:00",
//    "SourceFile":"http://www.nuriamacia.com/dm4ym/app/uploads/IPTC59ca5a808ffc15.84268283.jpg",
//    "Classroom":"Da Vinci",
//    "Notes":"construction site"
//    }
//  },
  </script>
</body>
</html>
